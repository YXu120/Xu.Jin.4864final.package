---
title: "my_function_bootstrap"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{my_function_bootstrap}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
# Load packages
library(Xu.Jin.4864final.package)
suppressMessages(library(dplyr))
suppressMessages(library(ggplot2))
suppressMessages(library(tidyverse))
suppressMessages(library(lme4))
suppressMessages(library(readr))
```

# 1. Brief Introduction
In this package, we create functions for fitting one of the generalized linear mixed effects models (GLMMs), the Poisson model, and implement maximum likelihood inference including computing point estimates, standard errors, and confidence intervals. 

A sample data set gopher tortoises (Ozgul et al., 2009) are used here to show how function works.

We first fit a Poisson model with tortoise data set. Then, we use then bootstrap to re-sample data to compute standard deviation and confidence interval. The goal is to test whether increasing in seroprevalence will affect survival of tortoise accounting for the area of each sites. 

This Vignette including Exploratory Data Analysis of original data set, Model Fitting Process, Bootstrap Process and Result Implication.


# 2. Exploratory Data Analysis
```{r}
# Import the sample data set
library(readr)
tortoise <- read_csv("gopher_tortoise.csv", show_col_types = FALSE)

# Clean the date set, removed unused column
tortoise_clean <- tortoise %>%
  select("Site", "year", "shells", "Area", "prev")
```

## 2.1 Relationship between number of shells and year effect

The plot shows the relationship between shells and year in original data set, it is grouped by each site. Each site shows different tendency of shell number in these three years, some increase, while other decrease.
```{r}
# Relationship between shells and year
tortoise_clean %>%
  ggplot(aes(x = year, y = shells, fill = Site)) +
  geom_bar(stat="identity") + 
  ggtitle("Shells Frequency Plot") +
  ylab("Number of Shells") +
  facet_wrap(. ~ Site, ncol=3) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5)) + 
  theme(legend.position = "none") +
  scale_y_continuous(breaks=seq(0, 9, 2))
```

\newpages

## 2.2 Relationship between number of shells and area of each sites

This plot shows relationship between area and shell. As plot shows, increasing in the area will somehow lead to an increase in number of shells. Hence. in the model, to avoid area effects, number of shells is divided by area.

```{r}
# Relationship between shells and sites area
tortoise_clean %>%
  ggplot(aes(x = Area, y = shells)) +
  geom_line() + 
  ggtitle("Shells Frequency VS Area") +
  ylab("Number of Shells") +
  facet_wrap(. ~ year, ncol=3) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5)) + 
  scale_x_continuous(breaks=seq(0, 60, 10))
```

\newpages

## 2.3 Relationship between average number of shells and seroprevalence

The first plot compares the relationship between number of shells and seroprevalence. However, we should consider the effect bring by area of each site.

```{r}
# Relationship between shells and seroprevalance (prev)
tortoise_clean %>%
  ggplot(aes(x = prev, y = shells)) +
  geom_line() + 
  ggtitle("Shells Frequency VS prev") +
  ylab("Average Number of Shells") +
  facet_wrap(. ~ year, ncol=3) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

The second plot compares the relationship between average number of shells and seroprevalence, where average number of shells means the number of shells divided by area. The observation here is, as seroprevalence increase, the number of shells also generally increase.

```{r}
# Divide shells by area
tortoise2 <- tortoise_clean %>%
  mutate(count_per_area = shells/Area)
```

```{r}
# Relationship between average shells and seroprevalance (prev)
tortoise2 %>%
  ggplot(aes(x = prev, y = count_per_area)) +
  geom_line() + 
  ggtitle("Average Shells Frequency VS prev") +
  ylab("Average Number of Shells") +
  facet_wrap(. ~ year, ncol=3) +
  theme_bw() + 
  theme(plot.title = element_text(hjust = 0.5))
```

# 3. Explanation of model fitting and bootstrap process

## 3.1 Fitting poisson model
In this part, we use function provided by Dr. Simon Bonner to fit a poisson model for this data set. We use number of shells as response variable, with predictors including seroprevalance, area, year and random effect bring by site.
```{r}
suppressMessages(run_model(tortoise, "tortoise"))
```

Summary of model shows that this data set has no random effects with 0 random effects variance.

## 3.2 Bootstrap and refitting 
```{r}

```


# 4. Explanation of summary output
```{r}

```

